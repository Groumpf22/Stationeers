#Centrifugal auto empty max 6
clr db
define CentrifugeNumber 7 #To be modified depending on number
define HASH("Centrifuge1")
define HASH("Centrifuge2")
define HASH("Centrifuge3")
define HASH("Centrifuge4")
define HASH("Centrifuge5")
define HASH("Centrifuge6")
define HASH("Centrifuge7")

alias InError r0
alias Pointer r1
alias HatchOpen r2
alias ReagentCount r3
alias CentriHash r4

main:
yield
yield
lb InError 690945935 Error Maximum #If one machine is in error
beqz InError main #skip to yield and loop if none in error
move Pointer 0 #initialize cursor
j iterateCentrifuge

iterateCentrifuge:
bgez Pointer CentrifugeNumber main #exit loop if iteration done (sp 0->nb-1, exit at nb)
get CentriHash db Pointer
add Pointer r1 1 #increment counter

lbn InError HASH("StructureCentrifuge") CentriHash Error Maximum #read error Centri
beqz InError iterateCentrifuge  #skip if not in error

lbn HatchOpen HASH("StructureCentrifuge") CentriHash Open Maximum #read reagent Centri
lbn ReagentCount HASH("StructureCentrifuge") CentriHash Reagents Sum #read reagent Centri

beqz HatchOpen openIfFull # closed: empty if full

#hatch open
beqz ReagentCount closeHatch #Empty -> close
j iterateCentrifuge

openIfFull:
beq ReagentCount 400 openHatch
j iterateCentrifuge

openHatch:
sbn HASH("StructureCentrifuge") CentriHash Open 1
j iterateCentrifuge

closeHatch:
sbn HASH("StructureCentrifuge") CentriHash Open 0
j iterateCentrifuge
